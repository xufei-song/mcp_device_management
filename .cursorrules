# MCP Streamable HTTP 服务器 - Cursor Rules

## 项目概述
基于 MCP 规范 2024-11-05 实现的测试设备管理 MCP 服务器，提供工具和提示功能。

## 快速启动
1. 运行环境设置: `scripts\setup.bat`
2. 激活环境: `scripts\activate.bat`
3. 启动MCP服务器: `scripts\run_fastmcp_server.bat`

## MCP集成方式
本项目仅支持 **HTTP Stream** 集成方式：
- **服务器地址**: http://localhost:8001/mcp
- **传输协议**: HTTP (基于FastAPI)
- **手动启动**: 使用 `scripts\run_fastmcp_server.bat` 手动启动服务器
- **Cursor配置**: 通过 `~/.cursor/mcp.json` 配置HTTP连接
- **不支持**: stdio、WebSocket等其他传输方式

## 服务器特性
- **详细日志输出**: 所有MCP操作都有详细日志输出，便于调试
- **2个测试工具**: 
  - `test_tool`: 接收消息并返回带时间戳的确认
  - 扩展工具: 可通过add_tool方法添加更多工具
- **2个测试提示**: 
  - `test_prompt`: 基于主题和上下文生成提示内容
  - 扩展提示: 可通过add_prompt方法添加更多提示
- **MCP协议支持**: 完整支持initialize、tools/list、tools/call、prompts/list、prompts/get
- **错误处理**: 完整的JSON-RPC 2.0错误处理机制

## Cursor MCP 配置
已配置在 `~/.cursor/mcp.json`:
```json
{
  "mcpServers": {
    "TestDeviceManagement": {
      "url": "http://localhost:8001/mcp",
      "description": "测试设备管理MCP服务器 - HTTP Stream方式连接"
    }
  }
}
```

## 使用流程
1. 启动MCP服务器: `scripts\run_mcp_server2.bat` (推荐)
2. 确认服务器运行在 http://localhost:8002
3. 在Cursor中直接使用MCP工具和提示
4. 查看服务器日志了解MCP交互情况

## 开发规则
- **官方SDK强制**: 必须使用官方MCP Python SDK (github.com/modelcontextprotocol/python-sdk) 开发MCP服务器
- **仅HTTP传输**: 本工程只考虑HTTP Stream集成方式，不支持stdio、WebSocket等其他传输方式
- **HTTP Stream Only**: 仅开发基于HTTP的MCP服务器，使用官方SDK的streamable_http传输协议
- **手动启动**: MCP服务器需要手动启动，不在mcp.json中配置自动启动
- **扩展开发**: 新增工具和提示都通过官方SDK的标准方法添加
- **日志优先**: 所有操作都要有详细的日志输出
- **SDK规范**: 严格遵循官方SDK的API设计和最佳实践

## 规范遵循
严格遵循 MCP 规范 2024-11-05，包括JSON-RPC 2.0消息格式、HTTP传输协议等。
